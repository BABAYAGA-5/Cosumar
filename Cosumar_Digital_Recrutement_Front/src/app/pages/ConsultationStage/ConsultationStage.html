<div class="consultation-stage">
  <div class="page-header">
    <h2>Consultation des Stages</h2>
    <p>Liste complÃ¨te des stagiaires et leur statut</p>
  </div>

  <!-- Filters Section -->
  <div class="filters-section">
    <div class="filters-container">
      <div class="filter-group">
        <label for="statusFilter">Filtrer par statut:</label>
        <select id="statusFilter" [(ngModel)]="selectedStatus" (change)="filterByStatus()">
          <option value="">Tous les statuts</option>
          <option value="en_attente_depot_dossier">En attente de dÃ©pÃ´t de dossier</option>
          <option value="en_attente_visite_medicale">En attente de visite mÃ©dicale</option>
          <option value="en_attente_des_signatures">En attente de signatures</option>
          <option value="stage_en_cours">Stage en cours</option>
          <option value="en_attente_depot_rapport">En attente de dÃ©pÃ´t de rapport</option>
          <option value="en_attente_signature_du_rapport_par_l_encadrant">En attente de signature du rapport par l'encadrant</option>
          <option value="termine">TerminÃ©</option>
          <option value="expire">ExpirÃ©</option>
          <option value="annule">AnnulÃ©</option>
        </select>
      </div>
      
      <div class="filter-group">
        <label for="natureFilter">Filtrer par nature:</label>
        <select id="natureFilter" [(ngModel)]="selectedNature" (change)="filterByNature()">
          <option value="">Toutes les natures</option>
          <option value="stage_observation">Stage d'observation</option>
          <option value="pfe">PFE</option>
          <option value="stage_application">Stage d'application</option>
        </select>
      </div>

      <div class="search-group">
        <input 
          type="text" 
          placeholder="Rechercher par nom, prÃ©nom ou matricule..." 
          [(ngModel)]="searchQuery"
          (input)="onSearchChange()"
          class="search-input">
      </div>
    </div>
  </div>

  <!-- Loading State -->
  @if (isLoading()) {
    <div class="loading-container">
      <div class="spinner"></div>
      <p>Chargement des stages...</p>
    </div>
  }

  <!-- Error State -->
  @else if (errorMessage()) {
    <div class="error-container">
      <div class="error-message">
        <h3>Erreur</h3>
        <p>{{ errorMessage() }}</p>
        <button (click)="loadStagiaires()" class="retry-btn">RÃ©essayer</button>
      </div>
    </div>
  }

  <!-- Empty State -->
  @else if (filteredStagiaires().length === 0 && !isLoading()) {
    <div class="empty-container">
      <div class="empty-message">
        <h3>Aucun stage trouvÃ©</h3>
        <p>{{ searchQuery || selectedStatus || selectedNature ? 'Aucun stage ne correspond aux critÃ¨res de recherche.' : 'Aucun stage n\'est actuellement enregistrÃ© dans le systÃ¨me.' }}</p>
        @if (searchQuery || selectedStatus || selectedNature) {
          <button (click)="clearFilters()" class="clear-filters-btn">Effacer les filtres</button>
        }
      </div>
    </div>
  }

  <!-- Stagiaires Grid -->
  @else {
    <div class="results-header">
      <p class="results-count">
        {{ filteredStagiaires().length }} stage(s) trouvÃ©(s)
        @if (searchQuery || selectedStatus || selectedNature) {
          <span class="filter-info">
            @if (searchQuery) { pour "{{ searchQuery }}" }
            @if (selectedStatus) { - Statut: {{ getStatusText(selectedStatus) }} }
            @if (selectedNature) { - Nature: {{ getNatureText(selectedNature) }} }
          </span>
        }
      </p>
      
      <div class="view-controls">
        <button 
          [class.active]="viewMode === 'grid'"
          (click)="setViewMode('grid')"
          class="view-btn grid-view-btn"
          title="Vue grille">
          ğŸ“±
        </button>
        <button 
          [class.active]="viewMode === 'list'"
          (click)="setViewMode('list')"
          class="view-btn list-view-btn"
          title="Vue liste">
          ğŸ“„
        </button>
      </div>
    </div>

    <div class="stagiaires-container" [class.list-view]="viewMode === 'list'" [class.grid-view]="viewMode === 'grid'">
      @for (stagiaire of filteredStagiaires(); track stagiaire.matricule) {
        <div class="stagiaire-wrapper" (click)="onStagiaireClick(stagiaire)">
          <StagiaireCard [stagiaire]="stagiaire"></StagiaireCard>
        </div>
      }
    </div>
  }
</div>
