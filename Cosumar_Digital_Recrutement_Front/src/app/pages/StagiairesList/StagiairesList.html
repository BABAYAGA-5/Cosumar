<div class="stagiaires-list">
  <h2>Liste des Stagiaires</h2>
  
  <!-- Filters Section -->
  <div class="filters-section">
    <div class="filters-container">
      <div class="search-container">
        <input 
          type="text" 
          [(ngModel)]="searchTerm" 
          (input)="onSearchInput()"
          placeholder="Rechercher par matricule, nom, prénom ou email..."
          class="search-input">
        <div class="search-icon"></div>
      </div>
      
      <div class="filter-selects">
        <select [(ngModel)]="selectedHasStage" (change)="onHasStageChange()" class="filter-select">
          @for (option of hasStageOptions; track option.value) {
            <option [value]="option.value">{{ option.label }}</option>
          }
        </select>
        
        <select 
          [(ngModel)]="selectedStageStatus" 
          (change)="onFilterChange()" 
          class="filter-select"
          [disabled]="!areStageFiltersEnabled()">
          @for (option of stageStatusOptions; track option.value) {
            <option [value]="option.value">{{ option.label }}</option>
          }
        </select>
        
        <select 
          [(ngModel)]="selectedStageNature" 
          (change)="onFilterChange()" 
          class="filter-select"
          [disabled]="!areStageFiltersEnabled()">
          @for (option of stageNatureOptions; track option.value) {
            <option [value]="option.value">{{ option.label }}</option>
          }
        </select>
        
        <button (click)="clearFilters()" class="clear-filters-btn" title="Effacer tous les filtres">
          <span class="clear-icon"></span>
          Effacer
        </button>
      </div>
    </div>
  </div>
  
  <!-- Pagination info -->
  @if (!loading && totalCount > 0) {
    <div class="pagination-info">
      Affichage de {{ ((currentPage - 1) * pageSize) + 1 }} à {{ getCurrentPageMax() }} sur {{ totalCount }} stagiaires
    </div>
  }
  
  @if (loading) {
    <div class="loading-spinner">
      <span class="spinner"></span> Chargement...
    </div>
  }
  @if (error) {
    <div class="error">{{ error }}</div>
  }
  @if (!loading && stagiaires.length) {
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Matricule</th>
            <th>Nom</th>
            <th>Prénom</th>
            <th>Email</th>
            <th>Téléphone</th>
            <th>Date de Naissance</th>
            <th>Stage Actuel</th>
            <th>Statut du Stage</th>
            <th>Date de Création</th>
          </tr>
        </thead>
        <tbody>
          @for (stagiaire of stagiaires; track stagiaire.id; let i = $index) {
            <tr>
              <td>{{ ((currentPage - 1) * pageSize) + i + 1 }}</td>
              <td><strong>{{ stagiaire.matricule }}</strong></td>
              <td><strong>{{ stagiaire.nom }}</strong></td>
              <td>{{ stagiaire.prenom }}</td>
              <td class="email-cell">
                @if (stagiaire.email) {
                  <a href="mailto:{{ stagiaire.email }}">{{ stagiaire.email }}</a>
                } @else {
                  <span>-</span>
                }
              </td>
              <td>{{ stagiaire.num_tel || '-' }}</td>
              <td>{{ stagiaire.date_naissance | date:'dd/MM/yyyy' }}</td>
              <td>
                @if (stagiaire.latest_stage_nature) {
                  <span class="nature-badge">
                    {{ getNatureLabel(stagiaire.latest_stage_nature) }}
                  </span>
                } @else {
                  <span class="no-stage">Aucun stage</span>
                }
              </td>
              <td>
                @if (stagiaire.latest_stage_status) {
                  <span class="status-badge" [ngClass]="{
                    'en-attente': stagiaire.latest_stage_status?.includes('en_attente'),
                    'en-cours': stagiaire.latest_stage_status === 'stage_en_cours',
                    'termine': stagiaire.latest_stage_status === 'termine',
                    'annule': stagiaire.latest_stage_status === 'annule',
                    'expire': stagiaire.latest_stage_status === 'expire'
                  }">
                    {{ getStatusLabel(stagiaire.latest_stage_status) }}
                  </span>
                } @else {
                  <span class="no-stage">-</span>
                }
              </td>
              <td>{{ stagiaire.created_at | date:'dd/MM/yyyy HH:mm' }}</td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }

  <!-- Pagination controls -->
  @if (!loading && totalPages > 1) {
    <div class="pagination">
      <button class="pagination-btn" [disabled]="!hasPrevious" (click)="previousPage()">
        ← Précédent
      </button>
      
      @if (currentPage > 3) {
        <button class="pagination-btn" (click)="goToPage(1)">1</button>
      }
      @if (currentPage > 4) {
        <span class="pagination-dots">...</span>
      }
      
      @for (page of getPageNumbers(); track page) {
        <button 
          class="pagination-btn" 
          [class.active]="page === currentPage"
          (click)="goToPage(page)">
          {{ page }}
        </button>
      }
      
      @if (currentPage < totalPages - 3) {
        <span class="pagination-dots">...</span>
      }
      @if (currentPage < totalPages - 2) {
        <button class="pagination-btn" (click)="goToPage(totalPages)">{{ totalPages }}</button>
      }
      
      <button class="pagination-btn" [disabled]="!hasNext" (click)="nextPage()">
        Suivant →
      </button>
    </div>
  }
  
  @if (!loading && !stagiaires.length) {
    <div>Aucun stagiaire trouvé.</div>
  }
  
</div>