<div class="dashboard-container">
  <!-- Sidebar -->
  <aside class="sidebar" [class.collapsed]="isSidebarCollapsed()">
    <div class="sidebar-header">
      <button class="sidebar-toggle" (click)="toggleSidebar()">
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
      </button>
      
      <div class="logo" style="margin-top: 20px;">
        @if (!isSidebarCollapsed()) {
          <h2 class="sidebar-text logo-main">COSUMAR DIGITAL</h2>
          <h3 class="sidebar-text logo-sub">RECRUTEMENT</h3>
        } @else {
          <h2 class="logo-collapsed">C</h2>
        }
      </div>
    </div>
    
    <nav class="sidebar-nav">
      <ul class="nav-menu">
        <li class="nav-item" [class.active]="activeMenuItem() === 'dashboard'" (click)="setActiveMenuItem('dashboard')" [attr.data-tooltip]="'Tableau de bord'">
          <i class="icon dashboard-icon"></i>
          @if (!isSidebarCollapsed()) {
            <span class="sidebar-text">Tableau de bord</span>
          }
        </li>
        <li class="nav-item" [class.active]="activeMenuItem() === 'creation_stage'" (click)="setActiveMenuItem('creation_stage')" [attr.data-tooltip]="'Création de Stage'">
          <i class="icon creation_stage-icon"></i>
          @if (!isSidebarCollapsed()) {
            <span class="sidebar-text">Création de Stage</span>
          }
        </li>
        <li class="nav-item" [class.active]="activeMenuItem() === 'candidatures'" (click)="setActiveMenuItem('candidatures')" [attr.data-tooltip]="'Candidatures'">
          <i class="icon candidatures-icon"></i>
          @if (!isSidebarCollapsed()) {
            <span class="sidebar-text">Candidatures</span>
          }
        </li>
        <li class="nav-item" [class.active]="activeMenuItem() === 'candidats'" (click)="setActiveMenuItem('candidats')" [attr.data-tooltip]="'Candidats'">
          <i class="icon candidats-icon"></i>
          @if (!isSidebarCollapsed()) {
            <span class="sidebar-text">Candidats</span>
          }
        </li>
        @if (userRole() === 'admin') {
          <li class="nav-item" [class.active]="activeMenuItem() === 'utilisateurs'" (click)="setActiveMenuItem('utilisateurs')" [attr.data-tooltip]="'Utilisateurs'">
            <i class="icon utilisateurs-icon"></i>
            @if (!isSidebarCollapsed()) {
              <span class="sidebar-text">Utilisateurs</span>
            }
          </li>
        }
        <li class="nav-item" [class.active]="activeMenuItem() === 'domaines'" (click)="setActiveMenuItem('domaines')" [attr.data-tooltip]="'Domaines'">
          <i class="icon domaines-icon"></i>
          @if (!isSidebarCollapsed()) {
            <span class="sidebar-text">Domaines</span>
          }
        </li>
      </ul>
    </nav>
  </aside>

  <!-- Main Content Area -->
  <main class="main-content">
    <!-- Top Header -->
    <header class="top-header">
      <div class="header-left">
        <h1 class="page-title">{{ getPageTitle() }}</h1>
      </div>
      
      <div class="header-right">
        <div class="notifications">
          <button class="notification-btn">
            <i class="bell-icon"></i>
            @if (notificationCount() > 0) {
              <span class="notification-badge">{{ notificationCount() }}</span>
            }
          </button>
        </div>
        
        <div class="user-menu">
          <button class="user-button" (click)="toggleUserMenu()">
            <div class="user-avatar">
              <i class="user-icon"></i>
            </div>
            <span class="user-name">{{ userName() }}</span>
            <i class="dropdown-arrow" [class.rotated]="isUserMenuOpen()"></i>
          </button>
          
          @if (isUserMenuOpen()) {
            <div class="user-dropdown">
              <div class="user-info">
                <div class="user-avatar-large">
                  <i class="user-icon"></i>
                </div>
                <div class="user-details">
                  <strong>{{ userName() }}</strong>
                  <span class="user-role">{{ userRole() }}</span>
                  <span class="user-email">{{ userEmail() }}</span>
                </div>
              </div>
              <hr class="dropdown-divider">
              <ul class="dropdown-menu">
                <li>
                  <button (click)="viewProfile()" class="dropdown-item">
                    <i class="profile-icon"></i>
                    <span>View Profile</span>
                  </button>
                </li>
                <li>
                  <button (click)="editProfile()" class="dropdown-item">
                    <i class="edit-icon"></i>
                    <span>Edit Profile</span>
                  </button>
                </li>
                <li>
                  <button (click)="accountSettings()" class="dropdown-item">
                    <i class="settings-icon"></i>
                    <span>Account Settings</span>
                  </button>
                </li>
                <li>
                  <hr class="dropdown-divider">
                </li>
                <li>
                  <button (click)="logout()" class="dropdown-item logout-item">
                    <i class="logout-icon"></i>
                    <span>Logout</span>
                  </button>
                </li>
              </ul>
            </div>
          }
        </div>
      </div>
    </header>

    <!-- Dashboard Content -->
    <div class="dashboard-content">
      <div class="content-area">
        @switch (activeMenuItem()) {
          @case ('dashboard') {
            <div class="dashboard-home">
              <div class="stats-grid">
                <div class="stat-card">
                  <div class="stat-icon postes-stat"></div>
                  <div class="stat-info">
                    @if (isLoading()) {
                      <h3 class="loading">...</h3>
                    } @else {
                      <h3>{{ totalPostes() }}</h3>
                    }
                    <p>Postes Actifs</p>
                  </div>
                </div>
                <div class="stat-card">
                  <div class="stat-icon candidatures-stat"></div>
                  <div class="stat-info">
                    @if (isLoading()) {
                      <h3 class="loading">...</h3>
                    } @else {
                      <h3>{{ totalCandidatures() }}</h3>
                    }
                    <p>Candidatures Reçues</p>
                  </div>
                </div>
                <div class="stat-card">
                  <div class="stat-icon utilisateurs-stat"></div>
                  <div class="stat-info">
                    @if (isLoading()) {
                      <h3 class="loading">...</h3>
                    } @else {
                      <h3>{{ totalUtilisateurs() }}</h3>
                    }
                    <p>Utilisateurs Actifs</p>
                  </div>
                </div>
                <div class="stat-card">
                  <div class="stat-icon candidatures-stat"></div>
                  <div class="stat-info">
                    @if (isLoading()) {
                      <h3 class="loading">...</h3>
                    } @else {
                      <h3>{{ pendingCandidatures() }}</h3>
                    }
                    <p>En Attente</p>
                  </div>
                </div>
              </div>
              
              <div class="charts-section">
                <div class="chart-card">
                  <h3>Évolution des Candidatures</h3>
                  <div class="chart-placeholder">
                    <p>Graphique des candidatures par mois</p>
                  </div>
                </div>
                <div class="chart-card">
                  <h3>Répartition par Département</h3>
                  <div class="chart-placeholder">
                    <p>Graphique des postes par département</p>
                  </div>
                </div>
              </div>
            </div>
          }
          @case ('creation_stage') {
            <div class="creation-stage-content">
              <h2>Création de Stage</h2>
              <div class="stage-form">
                <div class="form-section">
                  <h3>CIN du Stagiaire</h3>
                  <div class="file-upload-section">
                    <div class="file-upload-area" 
                         (dragover)="onDragOver($event)" 
                         (dragleave)="onDragLeave($event)" 
                         (drop)="onFileDropped($event)"
                         [class.dragover]="isDragOver">
                      <input 
                        type="file" 
                        id="cin-file" 
                        #fileInput
                        accept=".jpg,.jpeg,.png" 
                        (change)="onFileSelected($event)"
                        style="display: none"
                      >
                      
                      @if (!selectedFile()) {
                        <div class="upload-placeholder">
                          <i class="upload-icon"></i>
                          <p>Glissez-déposez votre CIN ici ou</p>
                          <button type="button" class="upload-btn" (click)="fileInput.click()">
                            Parcourir les fichiers
                          </button>
                          <small>JPG, JPEG, PNG uniquement</small>
                        </div>
                      } @else if (isUploading()) {
                        <div class="uploading-state">
                          <span class="spinner"></span>
                          <p>Scan du CIN en cours...</p>
                        </div>
                      } @else {
                        <div class="file-preview">
                          <div class="file-info">
                            <i class="file-icon"></i>
                            <span class="file-name">{{ selectedFile()?.name }}</span>
                            <span class="file-size">({{ getFileSize(selectedFile()?.size || 0) }})</span>
                          </div>
                          <button type="button" class="remove-file-btn" (click)="removeFile()">
                            <i class="delete-icon"></i>
                          </button>
                        </div>
                      }
                    </div>
                    
                    @if (selectedFile() && !isUploading()) {
                      <div class="cin-preview">
                        <h4>Aperçu du CIN</h4>
                        <img [src]="cinPreviewUrl()" alt="Aperçu CIN" class="cin-image">
                      </div>
                    }
                  </div>
                </div>

                @if (!extractedData() && selectedFile() && !isUploading()) {
                  <div class="form-actions">
                    <button type="button" class="cancel-btn" (click)="removeFile()">
                      Supprimer le fichier
                    </button>
                  </div>
                }

                @if (uploadMessage() && uploadMessage()?.type === 'error') {
                  <div class="message error">
                    <p>{{ uploadMessage()?.text }}</p>
                  </div>
                }

                @if (extractedData()) {
                  <div class="extracted-data-form">
                    <h3>Données extraites du CIN</h3>
                    <p class="form-note">Vérifiez et modifiez les informations si nécessaire :</p>
                    
                    <div class="form-grid">
                      <div class="form-group">
                        <label for="nom">Nom</label>
                        <textarea 
                          id="nom" 
                          [value]="extractedData()?.nom || ''" 
                          (input)="updateExtractedData('nom', $event)"
                          placeholder="Entrez le nom"
                          rows="2"
                        ></textarea>
                      </div>
                      
                      <div class="form-group">
                        <label for="prenom">Prénom</label>
                        <textarea 
                          id="prenom" 
                          [value]="extractedData()?.prenom || ''" 
                          (input)="updateExtractedData('prenom', $event)"
                          placeholder="Entrez le prénom"
                          rows="2"
                        ></textarea>
                      </div>
                      
                      <div class="form-group">
                        <label for="cin">Numéro CIN</label>
                        <input 
                          type="text" 
                          id="cin" 
                          [value]="extractedData()?.cin || ''" 
                          (input)="updateExtractedData('cin', $event)"
                          placeholder="Entrez le numéro CIN"
                        >
                      </div>
                      
                      <div class="form-group">
                        <label for="date_naissance">Date de naissance</label>
                        <input 
                          type="date" 
                          id="date_naissance" 
                          [value]="extractedData()?.date_naissance || ''" 
                          (input)="updateExtractedData('date_naissance', $event)"
                        >
                      </div>
                    </div>

                    <!-- Additional Documents Section -->
                    <div class="additional-documents">
                      <h3>Documents Complémentaires</h3>
                      <p class="form-note">Veuillez télécharger les documents suivants :</p>
                      
                      <div class="documents-grid">
                        <!-- Convention -->
                        <div class="document-upload-section">
                          <h4>Convention <span class="required">*</span></h4>
                          <div class="mini-upload-area" 
                               (dragover)="onDocumentDragOver($event, 'convention')" 
                               (dragleave)="onDocumentDragLeave($event, 'convention')" 
                               (drop)="onDocumentDropped($event, 'convention')"
                               [class.dragover]="documentDragStates()['convention']">
                            <input 
                              type="file" 
                              #conventionInput
                              accept=".pdf,.doc,.docx" 
                              (change)="onDocumentSelected($event, 'convention')"
                              style="display: none"
                            >
                            
                            @if (!documents()['convention']) {
                              <div class="mini-upload-placeholder">
                                <i class="mini-upload-icon">📄</i>
                                <p>Convention de stage</p>
                                <button type="button" class="mini-upload-btn" (click)="conventionInput.click()">
                                  Télécharger
                                </button>
                                <small>PDF, DOC, DOCX</small>
                              </div>
                            } @else {
                              <div class="mini-file-preview">
                                <span class="mini-file-name">{{ documents()['convention']?.name }}</span>
                                <button type="button" class="mini-remove-btn" (click)="removeDocument('convention')">×</button>
                              </div>
                            }
                          </div>
                        </div>

                        <!-- CV -->
                        <div class="document-upload-section">
                          <h4>CV <span class="required">*</span></h4>
                          <div class="mini-upload-area" 
                               (dragover)="onDocumentDragOver($event, 'cv')" 
                               (dragleave)="onDocumentDragLeave($event, 'cv')" 
                               (drop)="onDocumentDropped($event, 'cv')"
                               [class.dragover]="documentDragStates()['cv']">
                            <input 
                              type="file" 
                              #cvInput
                              accept=".pdf,.doc,.docx" 
                              (change)="onDocumentSelected($event, 'cv')"
                              style="display: none"
                            >
                            
                            @if (!documents()['cv']) {
                              <div class="mini-upload-placeholder">
                                <i class="mini-upload-icon">📋</i>
                                <p>Curriculum Vitae</p>
                                <button type="button" class="mini-upload-btn" (click)="cvInput.click()">
                                  Télécharger
                                </button>
                                <small>PDF, DOC, DOCX</small>
                              </div>
                            } @else {
                              <div class="mini-file-preview">
                                <span class="mini-file-name">{{ documents()['cv']?.name }}</span>
                                <button type="button" class="mini-remove-btn" (click)="removeDocument('cv')">×</button>
                              </div>
                            }
                          </div>
                        </div>

                        <!-- Assurance -->
                        <div class="document-upload-section">
                          <h4>Assurance <span class="required">*</span></h4>
                          <div class="mini-upload-area" 
                               (dragover)="onDocumentDragOver($event, 'assurance')" 
                               (dragleave)="onDocumentDragLeave($event, 'assurance')" 
                               (drop)="onDocumentDropped($event, 'assurance')"
                               [class.dragover]="documentDragStates()['assurance']">
                            <input 
                              type="file" 
                              #assuranceInput
                              accept=".pdf,.doc,.docx" 
                              (change)="onDocumentSelected($event, 'assurance')"
                              style="display: none"
                            >
                            
                            @if (!documents()['assurance']) {
                              <div class="mini-upload-placeholder">
                                <i class="mini-upload-icon">🛡️</i>
                                <p>Attestation d'assurance</p>
                                <button type="button" class="mini-upload-btn" (click)="assuranceInput.click()">
                                  Télécharger
                                </button>
                                <small>PDF, DOC, DOCX</small>
                              </div>
                            } @else {
                              <div class="mini-file-preview">
                                <span class="mini-file-name">{{ documents()['assurance']?.name }}</span>
                                <button type="button" class="mini-remove-btn" (click)="removeDocument('assurance')">×</button>
                              </div>
                            }
                          </div>
                        </div>

                        <!-- Lettre de motivation (Optionnel) -->
                        <div class="document-upload-section">
                          <h4>Lettre de motivation <span class="optional">(Optionnel)</span></h4>
                          <div class="mini-upload-area" 
                               (dragover)="onDocumentDragOver($event, 'lettre_motivation')" 
                               (dragleave)="onDocumentDragLeave($event, 'lettre_motivation')" 
                               (drop)="onDocumentDropped($event, 'lettre_motivation')"
                               [class.dragover]="documentDragStates()['lettre_motivation']">
                            <input 
                              type="file" 
                              #lettreInput
                              accept=".pdf,.doc,.docx" 
                              (change)="onDocumentSelected($event, 'lettre_motivation')"
                              style="display: none"
                            >
                            
                            @if (!documents()['lettre_motivation']) {
                              <div class="mini-upload-placeholder">
                                <i class="mini-upload-icon">✉️</i>
                                <p>Lettre de motivation</p>
                                <button type="button" class="mini-upload-btn" (click)="lettreInput.click()">
                                  Télécharger
                                </button>
                                <small>PDF, DOC, DOCX</small>
                              </div>
                            } @else {
                              <div class="mini-file-preview">
                                <span class="mini-file-name">{{ documents()['lettre_motivation']?.name }}</span>
                                <button type="button" class="mini-remove-btn" (click)="removeDocument('lettre_motivation')">×</button>
                              </div>
                            }
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="save-actions">
                      <button 
                        type="button" 
                        class="save-btn"
                        [disabled]="isSaving() || !canSaveUser()"
                        (click)="saveUser()"
                      >
                        @if (isSaving()) {
                          <span class="spinner"></span>
                          Enregistrement...
                        } @else {
                          Enregistrer l'utilisateur
                        }
                      </button>
                      
                      <button type="button" class="cancel-btn" (click)="resetExtractedData()">
                        Annuler
                      </button>
                    </div>

                    @if (saveMessage()) {
                      <div class="message" [class]="saveMessage()?.type">
                        <p>{{ saveMessage()?.text }}</p>
                      </div>
                    }
                  </div>
                }
              </div>
            </div>
          }
          @default {
            <div class="page-content">
              <h2>{{ getPageTitle() }}</h2>
              <p>Contenu pour {{ activeMenuItem() }} sera implémenté ici.</p>
            </div>
          }
        }
      </div>
    </div>
  </main>
</div>